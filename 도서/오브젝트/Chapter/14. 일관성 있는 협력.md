
# 14. 일관성 있는 협력

- 일관성 있는 협력 패턴을 적용하면 코드가 이해하기 쉽고 직관적이며 유연해진다.

# 🍉 핸드폰 과금 시스템 변경하기

## 기본 정책 확장

| 유형      | 형식                                                    | 예                                            |
| ------- | ----------------------------------------------------- | -------------------------------------------- |
| 고정요금 방식 | A초당 B원                                                | 10초당 18원                                     |
| 시간대별 방식 | A시부터 B시까지 C초당 D원<br>B시부터 C시까지 C초당 E원                  | 00시부터 19시까지 10초당 18원<br>19시부터 24시까지 10초당 15원 |
| 요일별 방식  | 평일에는 A초당 B원<br>공휴일에는 A초당 C원                           | 평일에는 10초당 38원<br>공휴일에는 10초당 19원<br>          |
| 구간별 방식  | 초기 A분 동안 B초당 C원<br>A분 ~ D분까지 B초당 D원<br>D분 초과 시 B초당 E원 | 초기 1분 동안 10초당 50원<br>초기 1분 이후 10초당 20원       |

- 기본 정책을 구성하는 4가지 방식
	- 고정 요금 방식 : 일정 시간 단위로 동일한 요금을 부과하는 방식.
	- 시간대별 방식 : 하루 24시간을 특정한 시간 구간으로 나눈 후 각 구간별로 서로 다른 요금을 부과하는 방식
	- 요일별 방식 : 요일별로 요금을 차등 부과하는 방식이다.
	- 구간별 방식: 전체 통화 시간을 일정한 통화 시간에 따라 나누고 각 구간별로 요금을 차등 부과하는 방식이다.


# 비 일관적인 설계
> 개념적으로 연관돼있지만 구현 방식에 제각각인 설계 방식은 두 가지 상황에서 방해가 됨.

- 새로운 구현을 추가해야 하는 상황
- 기존의 구현을 이해해야 하는 상황

> 유사한 기능은 유사한 방식으로 구현해야 한다.
> 코드 재사용을 위한 상속은 해롭다.

# 설계에 일관성 부여하기
> 일관성 있는 설계를 만들기 위한 조언

1. 다양한 설계 경험 익히기
2. 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해보기

> 다음과 같은 기본 지침을 따라보자

- 변하는 개념을 변하지 않는 개념으로부터 분리하라.
- 변하는 개념을 캡슐화하라.

## 클래스를 분리하기 위한 조건
> 조건 로직을 객체 사이의 이동으로 대체해보자. -> 커다란 클래스를 더 작은 클래스들로 분리해야 함.
> 그렇다면 클래스를 분리하기 위해 어떤 기준을 따르는 것이 좋을까? -> 단일 책임 원칙을 따르도록 클래스 분리하기.

- 구성 요소를 캡슐화하는 실행 지심은 객체지향의 핵심 덕목 중 하나다 : 시스템을 책임을 캡슐화한 섬들로 분리하고 그 섬들 간의 결합도를 제한하라.

## 캡슐화 다시 살펴보기
> 캡슐화는 단순히 데이터를 감추는 것이 아니라 소프트웨어 안에서 변할 수 있는 어떤 '개념'이라도 감추는 것이다.
> 즉, 데이터 은닉 이상의 역할을 하고 코드 수정으로 인한 파급효과를 제어할 수 있는 모든 기법이 캡슐화의 일종이다.

- 서브타입 캡슐화와 객체 캡슐화를 적용하는 방법
	- 변하는 부분을 분리해서 타입 계층을 만든다.
	- 변하지 않는 부분의 일부로 타입 계층을 합성한다.


# 일관성 있는 기본 정책 구현하기

- 변경 전 : 코드에 대해 가지고 있던 기존의 지식이 유사한 기능을 이해하는 데 도움이 되지 않음.
- 변경 후 : 협력을 일관성 있게 만들면 변하지 않는 부분은 모든 기본 정책에서 공통적이므로 코드를 한번 이해하면 다른 코드를 이해하는데 지식을 사용 할 수 있음.
## 지속적으로 개선하라
- 협력은 고정된 것이 아니다. 요구사항의 변경에 따라 협력 역시 지속적으로 개선하고 리팩토링해야 한다.

# 패턴을 찾아라
- 애플리케이션에 유사한 기능에 대한 변경이 지속적으로 발생하고 있다면 변경을 캡슐화 할 수 있는 적절한 추상화를 찾은 후, 이 추상화에 변하지 않는 공통적인 책임을 할당하라.
- 현재의 구조가 변경을 캡슐화하기에 적합하지 않다면 코드를 수정하지 않고도 원하는 변경을 수용할 수 있도록 협력과 코드를 리팩터링 하라.
- 변경을 수용할 수 있는 적절한 역할과 책임을 찾다 보면 협력의 일관성이 서서히 윤곽을 드러낼 것이다.

